- name: Unconfigure network interfaces
  block:
    - name: Determine the network manager (netplan, ifupdown, network_manager, networkd)
      ansible.builtin.include_tasks: get_manager.yml

    - name: Uninstall any Network Manager dispatcher hooks.
      ansible.builtin.include_tasks: uninstall/interface/hook/network_manager.yml
      when: '"network_manager" in eseries_ip_manager_tools'

    - name: Remove network interfaces using ifupdown configuration.
      ansible.builtin.include_tasks: uninstall/interface/ifupdown.yml
      when: '"ifupdown" in eseries_ip_manager_tools'

    - name: Remove network interfaces using netplan configuration.
      ansible.builtin.include_tasks: uninstall/interface/netplan.yml
      when: '"netplan" in eseries_ip_manager_tools'
  when: eseries_ip_configure_network

- name: Set facts required for unconfiguring persistent network interface names.
  ansible.builtin.set_fact:
    eseries_common_udev_name: "{{ eseries_ip_udev_name }}"
    eseries_common_udev_rules: "{{ eseries_ip_udev_rules }}"

- name: Unconfigure persistent network interface names.
  ansible.builtin.include_role:
    name: netapp_eseries.host.common
    tasks_from: interface/map_name/uninstall.yml

- name: Determine facts for removing any firewall configuration.
  ansible.builtin.set_fact:
    eseries_common_interfaces: "{{ eseries_ip_interfaces }}"
    eseries_common_firewall_zone: "{{ eseries_ip_interface_common['zone'] | default(eseries_ip_firewall_zone | default(eseries_common_firewall_zone | default(''))) }}"

- name: Remove any firewall configuration.
  ansible.builtin.include_role:
    name: common
    tasks_from: interface/firewall_zone/uninstall.yml
  when: eseries_ip_configure_firewall
