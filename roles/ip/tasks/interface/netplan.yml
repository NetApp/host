- name: Ensure interfaces have netplan configuration files.
  ansible.builtin.template:
    src: "{{ lookup('netapp_eseries.host.eseries_template_path', 'netplan.j2') }}"
    dest: "{{ eseries_ip_netplan_path }}99-eseries-ansible-{{ item['name'] }}.yaml"
  register: netplan
  loop: "{{ eseries_ip_interfaces }}"
  become: true

- name: Install any network manager dispatcher hooks.
  ansible.builtin.include_tasks: hook/dispatcher.yml
  when: '"network_manager" in eseries_ip_manager_tools or "networkd" in eseries_ip_manager_tools'
  vars:
    interface_config_results: '{{ netplan["results"] }}'

- name: Apply any changes to Netplan configuration.
  ansible.builtin.command: netplan apply
  become: true
  when: netplan['changed']
