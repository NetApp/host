- name: Check whether /etc/multipath.conf exists
  stat:
    path: "/etc/multipath.conf"
  register: multipath_conf
  become: true

- name: Ensure that multipath.conf exists.
  file:
    state: touch
    path: "/etc/multipath.conf"
  when: not multipath_conf["stat"]["exists"]
  become: true

- name: Ensure multipath modules have been added to boot.
  template:
    src: eseries_multipath_conf.j2
    dest: "{{ eseries_multipath_modules_d }}eseries_multipath.conf"
  become: true

- name: Ensure multipathd daemon has been started and is enabled.
  systemd:
    state: started
    name: multipathd.service
    enabled: true
  become: true
